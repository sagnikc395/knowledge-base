import{f as p,a as t}from"./CCM6-gPc.js";import"./ChUk9lal.js";import{x as c}from"./BE8cp4uu.js";import{l as r,s as F}from"./D9W1QFau.js";import{M as A}from"./i8E_CZTo.js";const s={title:"Svelte Reactivity",date:"25/7/25",tags:["svelte","frontend","reactivity","svelte-basics","ui"]},{title:m,date:b,tags:v}=s;var y=p(`<h3>State</h3> <ul><li>At the heart of Svelte is a powerful system of reactivity for keeping the DOM in sync with our application state - eg: in response to an event.</li> <li>We can make the declaration reactive by wrapping the value with <code>$state(...)</code></li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> count </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">state</span><span style="color:#FFF">(</span><span style="color:#FFC799">0</span><span style="color:#FFF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">	function</span><span style="color:#FFC799"> incrementCounter</span><span style="color:#FFF">() &#123;</span></span>
<span class="line"><span style="color:#FFF">		count </span><span style="color:#A0A0A0">+=</span><span style="color:#FFC799"> 1</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#A0A0A0">		if</span><span style="color:#FFF"> (count </span><span style="color:#A0A0A0">%</span><span style="color:#FFC799"> 5</span><span style="color:#A0A0A0"> ==</span><span style="color:#FFC799"> 0</span><span style="color:#FFF">) &#123;</span></span>
<span class="line"><span style="color:#FFF">			count </span><span style="color:#A0A0A0">=</span><span style="color:#FFC799"> 0</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#FFF">		&#125;</span></span>
<span class="line"><span style="color:#FFF">	&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B8B8B94">&#x3C;!-- and using it as --></span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0"> onclick</span><span style="color:#FFF">=</span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">increment</span><span style="color:#A0A0A0">&#125;></span></span>
<span class="line"><span style="color:#FFF">	Clicked </span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">counter</span><span style="color:#A0A0A0">&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">	&#123;</span><span style="color:#FFF">counter </span><span style="color:#A0A0A0">===</span><span style="color:#FFC799"> 1</span><span style="color:#A0A0A0"> ?</span><span style="color:#99FFE4"> 'time'</span><span style="color:#A0A0A0"> :</span><span style="color:#99FFE4"> 'times'</span><span style="color:#A0A0A0">&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>This is called as a rune, and this is how we tell Svelte that <code>count</code> isn’t a ordinary variable.</li> <li>Runes look like functions , but they are not — when we use Svelte , they are a language construct itself.</li></ul> <h3>Deep State:</h3> <ul><li>State not only reacts to reassignments, but also reacts to mutations - we call this deep reactivity.</li> <li>We can also make an array reactive for example.</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> numbers </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">state</span><span style="color:#FFF">([</span><span style="color:#FFC799">1</span><span style="color:#FFF">, </span><span style="color:#FFC799">2</span><span style="color:#FFF">, </span><span style="color:#FFC799">3</span><span style="color:#FFF">, </span><span style="color:#FFC799">4</span><span style="color:#FFF">, </span><span style="color:#FFC799">5</span><span style="color:#FFF">]);</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>And now when we change the array , the component updates. Or better , we can <code>push</code> to the array instead.</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	function</span><span style="color:#FFC799"> addNumber</span><span style="color:#FFF">() &#123;</span></span>
<span class="line"><span style="color:#FFF">		numbers[numbers.length] </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> numbers.length </span><span style="color:#A0A0A0">+</span><span style="color:#FFC799"> 1</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#FFF">	&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>I.e better way to push it :</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	function</span><span style="color:#FFC799"> addNumber</span><span style="color:#FFF">() &#123;</span></span>
<span class="line"><span style="color:#FFF">		numbers.</span><span style="color:#FFC799">push</span><span style="color:#FFF">(numbers.length </span><span style="color:#A0A0A0">+</span><span style="color:#FFC799"> 1</span><span style="color:#FFF">);</span></span>
<span class="line"><span style="color:#FFF">	&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>Deep reactivity is implemented using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="nofollow">proxies</a> and mutations to the proxy itself do not affect the original object.</li></ul> <h3>Derived State:</h3> <ul><li>Often, we would need to derive state from other state. For this we have the <code>$derived</code> rune.</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> numbers </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">state</span><span style="color:#FFF">([</span><span style="color:#FFC799">1</span><span style="color:#FFF">, </span><span style="color:#FFC799">2</span><span style="color:#FFF">, </span><span style="color:#FFC799">3</span><span style="color:#FFF">, </span><span style="color:#FFC799">4</span><span style="color:#FFF">, </span><span style="color:#FFC799">5</span><span style="color:#FFF">]);</span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> total </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">derived</span><span style="color:#FFF">(numbers.</span><span style="color:#FFC799">reduce</span><span style="color:#FFF">((t, n) </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> t </span><span style="color:#A0A0A0">+</span><span style="color:#FFF"> n, </span><span style="color:#FFC799">0</span><span style="color:#FFF">));</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">p</span><span style="color:#A0A0A0">>&#123;</span><span style="color:#FFF">numbers.</span><span style="color:#FFC799">join</span><span style="color:#FFF">(</span><span style="color:#99FFE4">' + '</span><span style="color:#FFF">)</span><span style="color:#A0A0A0">&#125;</span><span style="color:#FFF"> = </span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">total</span><span style="color:#A0A0A0">&#125;&#x3C;/</span><span style="color:#FFC799">p</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>This expression inside the <code>$derived</code> declaration will be re-evaluated whenever its dependencies(here numbers) are updated.</li></ul> <h3>Inspecting State</h3> <ul><li>Often useuful to be able to track the value of a piece of state as it changes over time.</li> <li>If we add a console.log to a click handler and open the console drawer, well see a warning and a message saying that the message could not be cloned</li> <li>This is because <code>numbers</code> is a reactive <code>proxy</code>. There are a couple of things that we can do <ul><li>We can create a non-reactive snapshot of the state using <code>$state.snapshot(...)</code></li> <li>Alternatively we can use the <code>$inspect</code> rune to automatically log a snapshot of the state whenever it changes.</li> <li>We can customize how the info is displayed by using <code>$inspect(...)with(fn)</code> eg: can use <code>console.trace</code> to see where the state change originates from</li></ul></li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#FFF">	$</span><span style="color:#FFC799">inspect</span><span style="color:#FFF">(numbers).</span><span style="color:#FFC799">with</span><span style="color:#FFF">(console.trace);</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>So the full code will be as :</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> numbers </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">state</span><span style="color:#FFF">([</span><span style="color:#FFC799">1</span><span style="color:#FFF">, </span><span style="color:#FFC799">2</span><span style="color:#FFF">, </span><span style="color:#FFC799">3</span><span style="color:#FFF">, </span><span style="color:#FFC799">4</span><span style="color:#FFF">]);</span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> total </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">derived</span><span style="color:#FFF">(numbers.</span><span style="color:#FFC799">reduce</span><span style="color:#FFF">((t, n) </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> t </span><span style="color:#A0A0A0">+</span><span style="color:#FFF"> n, </span><span style="color:#FFC799">0</span><span style="color:#FFF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">	function</span><span style="color:#FFC799"> addNumber</span><span style="color:#FFF">() &#123;</span></span>
<span class="line"><span style="color:#FFF">		numbers.</span><span style="color:#FFC799">push</span><span style="color:#FFF">(numbers.length </span><span style="color:#A0A0A0">+</span><span style="color:#FFC799"> 1</span><span style="color:#FFF">);</span></span>
<span class="line"><span style="color:#8B8B8B94">		//console.log(numbers);</span></span>
<span class="line"><span style="color:#FFF">		console.</span><span style="color:#FFC799">log</span><span style="color:#FFF">($state.</span><span style="color:#FFC799">snapshot</span><span style="color:#FFF">(numbers));</span></span>
<span class="line"><span style="color:#FFF">	&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">p</span><span style="color:#A0A0A0">>&#123;</span><span style="color:#FFF">numbers.</span><span style="color:#FFC799">join</span><span style="color:#FFF">(</span><span style="color:#99FFE4">' + '</span><span style="color:#FFF">)</span><span style="color:#A0A0A0">&#125;</span><span style="color:#FFF"> = </span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">total</span><span style="color:#A0A0A0">&#125;&#x3C;/</span><span style="color:#FFC799">p</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0"> onclick</span><span style="color:#FFF">=</span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">addNumber</span><span style="color:#A0A0A0">&#125;></span><span style="color:#FFF"> Add a number </span><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0">></span></span></code></pre> <h3>Effects:</h3> <ul><li>We have only talked about reactivity in terms of state.</li> <li>But that’s only half of the equation - state is only reactive if something is reacting to it, otherwise it’s just a sparkling variable.</li> <li>The thing that reacts is called an <code>effect</code>.</li> <li>Till now we have encountered effects - the ones that Svelte creates on our behalf to update the DOM in response to state changes - but we can also create our own with the <code>$effect</code> rune.</li> <li>IMP: <ul><li><code>$effect</code> is best thought of as a escape hatch, rather than something to use frequently.</li> <li>If we can put our side effects in an <code>event handler</code>, eg: , that’s almost always preferable.</li></ul></li> <li>Cleanup function is called immediately before the effect function re-runs when the <code>interval</code> changes, and also when the component is destroyed.</li> <li>If the effect function doesn’t read any state when it runs, it will run once, when the component mounts.</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> elapsed </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">state</span><span style="color:#FFF">(</span><span style="color:#FFC799">0</span><span style="color:#FFF">);</span></span>
<span class="line"><span style="color:#A0A0A0">	let</span><span style="color:#FFF"> interval </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> $</span><span style="color:#FFC799">state</span><span style="color:#FFF">(</span><span style="color:#FFC799">100</span><span style="color:#FFF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">	$</span><span style="color:#FFC799">effect</span><span style="color:#FFF">(() </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> &#123;</span></span>
<span class="line"><span style="color:#A0A0A0">		const</span><span style="color:#FFF"> id </span><span style="color:#A0A0A0">=</span><span style="color:#FFC799"> setInterval</span><span style="color:#FFF">(() </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> &#123;</span></span>
<span class="line"><span style="color:#FFF">			elapsed </span><span style="color:#A0A0A0">+=</span><span style="color:#FFC799"> 1</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#FFF">		&#125;, interval);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B8B8B94">		//cleanup for the effect</span></span>
<span class="line"><span style="color:#A0A0A0">		return</span><span style="color:#FFF"> () </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> &#123;</span></span>
<span class="line"><span style="color:#FFC799">			clearInterval</span><span style="color:#FFF">(id);</span></span>
<span class="line"><span style="color:#FFF">		&#125;;</span></span>
<span class="line"><span style="color:#FFF">	&#125;);</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0"> onclick</span><span style="color:#FFF">=</span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">() </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> (interval </span><span style="color:#A0A0A0">/=</span><span style="color:#FFC799"> 2</span><span style="color:#FFF">)</span><span style="color:#A0A0A0">&#125;></span><span style="color:#FFF">speed up</span><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0"> onclick</span><span style="color:#FFF">=</span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">() </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> (interval </span><span style="color:#A0A0A0">*=</span><span style="color:#FFC799"> 2</span><span style="color:#FFF">)</span><span style="color:#A0A0A0">&#125;></span><span style="color:#FFF">slow down</span><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">p</span><span style="color:#A0A0A0">></span><span style="color:#FFF">elapsed: </span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">elapsed</span><span style="color:#A0A0A0">&#125;&#x3C;/</span><span style="color:#FFC799">p</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>Note: Effects do not run during server-side rendering.</li></ul> <h3>Universal Reactivity:</h3> <ul><li>We can also use runes outside components, for example to share some global state.</li> <li>We can use it as a global context as:</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">export</span><span style="color:#A0A0A0"> const</span><span style="color:#FFF"> counter </span><span style="color:#A0A0A0">=</span><span style="color:#FFC799"> $state</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"><span style="color:#FFF">	count: </span><span style="color:#FFC799">0</span></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span></code></pre> <ul><li>This causes an error, as we can’t use runes in normal .js files, only .svelte.js files.</li> <li>Renaming the file as shared.svelte.js</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">export</span><span style="color:#A0A0A0"> const</span><span style="color:#FFF"> counter </span><span style="color:#A0A0A0">=</span><span style="color:#FFC799"> $state</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"><span style="color:#FFF">	count: </span><span style="color:#FFC799">0</span></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span></code></pre> <ul><li>Counter:</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"><span style="color:#A0A0A0">	import</span><span style="color:#FFF"> &#123; counter &#125; </span><span style="color:#A0A0A0">from</span><span style="color:#99FFE4"> './shared.svelte.js'</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">script</span><span style="color:#A0A0A0">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0"> onclick</span><span style="color:#FFF">=</span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">() </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> (counter.count </span><span style="color:#A0A0A0">+=</span><span style="color:#FFC799"> 1</span><span style="color:#FFF">)</span><span style="color:#A0A0A0">&#125;></span></span>
<span class="line"><span style="color:#FFF">	clicks: </span><span style="color:#A0A0A0">&#123;</span><span style="color:#FFF">counter.count</span><span style="color:#A0A0A0">&#125;</span></span>
<span class="line"><span style="color:#A0A0A0">&#x3C;/</span><span style="color:#FFC799">button</span><span style="color:#A0A0A0">></span></span></code></pre> <ul><li>This will share the state, and when we click any button, all the three will update simultaenously.</li> <li>We cannot export a <code>$state</code> declaration from a module if the declaration is reassigned (rather than just mutated) because the importers would have no way to know about it.</li></ul>`,1);function g(a,n){const l=r(n,["children","$$slots","$$events","$$legacy"]);A(a,F(()=>l,()=>s,{children:(o,i)=>{var e=y();c(64),t(o,e)},$$slots:{default:!0}}))}export{g as default,s as metadata};
