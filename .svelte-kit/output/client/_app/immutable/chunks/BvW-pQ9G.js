import{f as o,a as i}from"./CCM6-gPc.js";import"./ChUk9lal.js";import{x as r}from"./BE8cp4uu.js";import{l as p,s as c}from"./D9W1QFau.js";import{M as d}from"./i8E_CZTo.js";const s={title:"Middlewares, Global Catches, Data Validation and Auth Basics",tags:["middlewares","zod","jwt"],date:"1/21/26"},{title:b,tags:f,date:A}=s;var h=o(`<h3>middlewares</h3> <ul><li>what is the best place to do these prechecks ?</li> <li>eg: authentication and input validation</li> <li>do we need to write custom logic each time to check ? hint: for some things yes!</li> <li>this is the job of middlewares - to do things that is either business logic or something that is not part of the main routing and request logic that can’t be handled by express.</li> <li>the dumb way of input validation is to take everything in query parameters or headers, and do it in the routing logic itself without seperating into business logic.</li></ul> <pre class="shiki vesper" style="background-color:#101010;color:#FFF"><code><span class="line"><span style="color:#8B8B8B94">//a scratch middleware</span></span>
<span class="line"><span style="color:#FFF">app.</span><span style="color:#FFC799">get</span><span style="color:#FFF">(</span><span style="color:#99FFE4">"/health-checkup"</span><span style="color:#FFF">, (req, res) </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> &#123;</span></span>
<span class="line"><span style="color:#8B8B8B94">//auth for now</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">const</span><span style="color:#FFF"> userName </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> req.headers.userName;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">const</span><span style="color:#FFF"> passwd </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> req.headers.passwd;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">const</span><span style="color:#FFF"> kidneyId </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> req.query.kidneyId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">if</span><span style="color:#FFF"> (</span><span style="color:#A0A0A0">!</span><span style="color:#FFF">userName </span><span style="color:#A0A0A0">===</span><span style="color:#99FFE4"> "sagnik"</span><span style="color:#A0A0A0"> &#x26;&#x26;</span><span style="color:#FFF"> passwd </span><span style="color:#A0A0A0">===</span><span style="color:#99FFE4"> "pass"</span><span style="color:#FFF">) &#123;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">res.</span><span style="color:#FFC799">status</span><span style="color:#FFF">(</span><span style="color:#FFC799">403</span><span style="color:#FFF">).</span><span style="color:#FFC799">json</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">msg: </span><span style="color:#99FFE4">" something wrong with inputs"</span><span style="color:#FFF">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">return</span><span style="color:#FFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">if</span><span style="color:#FFF"> (kidneyId </span><span style="color:#A0A0A0">!=</span><span style="color:#FFC799"> 1</span><span style="color:#A0A0A0"> ||</span><span style="color:#FFF"> kidneyId </span><span style="color:#A0A0A0">!=</span><span style="color:#FFC799"> 2</span><span style="color:#FFF">) &#123;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">res.</span><span style="color:#FFC799">status</span><span style="color:#FFF">(</span><span style="color:#FFC799">403</span><span style="color:#FFF">).</span><span style="color:#FFC799">json</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">msg: </span><span style="color:#99FFE4">"something wrong with inputs"</span><span style="color:#FFF">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">return</span><span style="color:#FFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">&#125;</span></span>
<span class="line"><span style="color:#FFF">res.</span><span style="color:#FFC799">status</span><span style="color:#FFF">(</span><span style="color:#FFC799">200</span><span style="color:#FFF">).</span><span style="color:#FFC799">json</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"><span style="color:#FFF">msg: </span><span style="color:#99FFE4">"input validataion done!"</span><span style="color:#FFF">,</span></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span>
<span class="line"><span style="color:#8B8B8B94">//a scratch middleware</span></span>
<span class="line"><span style="color:#FFF">app.</span><span style="color:#FFC799">get</span><span style="color:#FFF">(</span><span style="color:#99FFE4">"/health-checkup"</span><span style="color:#FFF">, (req, res) </span><span style="color:#A0A0A0">=></span><span style="color:#FFF"> &#123;</span></span>
<span class="line"><span style="color:#8B8B8B94">  //auth for now</span></span>
<span class="line"><span style="color:#A0A0A0">  const</span><span style="color:#FFF"> userName </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> req.headers.userName;</span></span>
<span class="line"><span style="color:#A0A0A0">  const</span><span style="color:#FFF"> passwd </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> req.headers.passwd;</span></span>
<span class="line"><span style="color:#A0A0A0">  const</span><span style="color:#FFF"> kidneyId </span><span style="color:#A0A0A0">=</span><span style="color:#FFF"> req.query.kidneyId;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A0A0">  if</span><span style="color:#FFF"> (</span><span style="color:#A0A0A0">!</span><span style="color:#FFF">userName </span><span style="color:#A0A0A0">===</span><span style="color:#99FFE4"> "sagnik"</span><span style="color:#A0A0A0"> &#x26;&#x26;</span><span style="color:#FFF"> passwd </span><span style="color:#A0A0A0">===</span><span style="color:#99FFE4"> "pass"</span><span style="color:#FFF">) &#123;</span></span>
<span class="line"><span style="color:#FFF">    res.</span><span style="color:#FFC799">status</span><span style="color:#FFF">(</span><span style="color:#FFC799">403</span><span style="color:#FFF">).</span><span style="color:#FFC799">json</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"><span style="color:#FFF">      msg: </span><span style="color:#99FFE4">" something wrong with inputs"</span><span style="color:#FFF">,</span></span>
<span class="line"><span style="color:#FFF">    &#125;);</span></span>
<span class="line"><span style="color:#A0A0A0">    return</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#FFF">  &#125;</span></span>
<span class="line"><span style="color:#A0A0A0">  if</span><span style="color:#FFF"> (kidneyId </span><span style="color:#A0A0A0">!=</span><span style="color:#FFC799"> 1</span><span style="color:#A0A0A0"> ||</span><span style="color:#FFF"> kidneyId </span><span style="color:#A0A0A0">!=</span><span style="color:#FFC799"> 2</span><span style="color:#FFF">) &#123;</span></span>
<span class="line"><span style="color:#FFF">    res.</span><span style="color:#FFC799">status</span><span style="color:#FFF">(</span><span style="color:#FFC799">403</span><span style="color:#FFF">).</span><span style="color:#FFC799">json</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"><span style="color:#FFF">      msg: </span><span style="color:#99FFE4">"something wrong with inputs"</span><span style="color:#FFF">,</span></span>
<span class="line"><span style="color:#FFF">    &#125;);</span></span>
<span class="line"><span style="color:#A0A0A0">    return</span><span style="color:#FFF">;</span></span>
<span class="line"><span style="color:#FFF">  &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFF">  res.</span><span style="color:#FFC799">status</span><span style="color:#FFF">(</span><span style="color:#FFC799">200</span><span style="color:#FFF">).</span><span style="color:#FFC799">json</span><span style="color:#FFF">(&#123;</span></span>
<span class="line"><span style="color:#FFF">    msg: </span><span style="color:#99FFE4">"input validataion done!"</span><span style="color:#FFF">,</span></span>
<span class="line"><span style="color:#FFF">  &#125;);</span></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span>
<span class="line"><span style="color:#FFF">&#125;);</span></span></code></pre> <ul><li>what if we tell you to introduce another route that does kidney replacement ? inputs need to be the same <ul><li>it would be a post route</li> <li>we would again need to do input validation there again</li> <li>violates the DRY principle</li> <li>best if we abstract that logic elsewhere and check it there itself.</li></ul></li> <li>the real optimum to do all these things is to do prechecks using middlewares <ul><li>middlewares is just another function that is specialized for that.</li> <li>we can also then pick and choose various different middlewares for different things</li></ul></li> <li>How does middlewares pass that information to the other middleware  and how does it interact with other middleware ? <ul><li>In the express http functions, instead of one callback functions, we can in fact give a range of callback functions.</li> <li>there are 3 inputs to the callbacks, res,req,next <ul><li>next we can call , if we think the things are fine</li> <li>req, res used for pre-checks</li> <li>if things are fine , then we chain it back to next</li> <li>under the hood, express handles this</li></ul></li> <li>there can be multiple functions , instead of just one handler.</li></ul></li> <li><code>app.use()</code> <ul><li>only then can we catch any body that the response sends in the POST body handler.</li> <li>this middleware is going to be called everywhere.</li> <li>instead of passing it explictly, anything that comes after the <code>app.use()</code> line will have th middleware inside it.</li></ul></li></ul> <h3>input-validation</h3> <ul><li>need some checks on the data that we are sending.</li> <li>a very basic way is to catch the fields that we are passing in the request parameters and we check on that.</li> <li>cause backends are open and people can send request with any type of inputs / wrong inputs.</li> <li>as a application developer, its our duty to do sanity checks and do input validation so that server doesnt crash.</li> <li>another type of middleware in js <ul><li>Problem: someone else can read your exception eg: end-client can read the exception.</li> <li>end user should see a clean repr of what happened.</li> <li>express handles this under the hood</li> <li>but better way to do is to use a global catches.</li> <li>so we put <code>app.use(express.json())</code> before all the code</li> <li>so any exception that is being caused, is handled in the global catches.</li> <li>error handling middlewares: <ul><li>Special type of middleware function in Express that has 4 arguments instead of three <code>(rerr,req,res,next)</code></li> <li>Express will recognize this as an error handling middleware because of these 4 arguments.</li></ul></li></ul></li> <li>zod library: <ul><li>to do input validation.</li> <li>better way to do validation</li> <li>prebuilt template and logic to check how to do input validation.</li> <li>In Zod , what we are doing basically is parsing the input and checking on that <ul><li>We define the schema on what the data should be like and zod will parse based on that.</li></ul></li> <li>zod gives us everything and gives us a bunch of error messages <ul><li>super useful if you wanna show that in the UI.</li> <li>some methods are present that we need to use it and use <code>safeParse</code> and the success object to check if validation passed or not.</li></ul></li></ul></li></ul> <h3>authentication and JWT</h3> <ul><li>anyone can send requests to your backend</li> <li>how to ensure that this user has access to a certain resource ?</li> <li>dumb way - ask user to send username and password</li> <li>Better way- <ul><li>give the user back a token on signup / login</li> <li>ask the user to send back the token in all future requests</li> <li>when the user logs out, ask the user to forget the token (or revoke it from the backend)</li></ul></li> <li>![[Screenshot 2026-01-21 at 6.23.32 PM.png]]</li> <li>Either an authorization header and this token is how we do signin / signup in websites.</li> <li>User will creating this request and this is how we do authorization for it.</li> <li>Project : <ul><li>let people sign up to your website</li> <li>only allowed signed in users to see people( create a dummy people list)</li> <li>only allowed the signin users can access the content.</li></ul></li> <li>before we learn authentication, some cryptography jargon: <ul><li>hashing <ul><li>before we save the passwords to the db , we hash it, so that only users can access that.</li> <li>and the hashed password will be stored in database</li> <li>hashing -> converting a simple string to complicated gibberish, so that its only one way ; can never guess -> can never decrypt back to password.</li> <li>how does the backend server validate this ? <ul><li>backend server reconverts back to the string and compares it.</li> <li>first inmemory we convert it back to the string and check if it is the same thing</li> <li>one way (convert a string to hash )</li></ul></li></ul></li> <li>Encryption <ul><li>this is 2 way</li> <li>can always convert the hashed result to the original string , provided we have some key.</li> <li>hashing doesnt really require a password, encryption requires a password.</li> <li>a string is encrypted using a password</li> <li>string can also be decrypted using the same password.</li></ul></li> <li>JSON web tokens <ul><li>some hashing function, but only works for JSON input</li> <li>gives more structured data -> more longer string</li> <li>in the end if we look at it, it is significantly different from hashing and encryption.</li> <li>takes JSON as a input</li> <li>Token: <ul><li>it takes this and creates a token in the end</li> <li>JWT</li> <li>by default whoever has this input , can convert it back to the original object that we see.</li> <li>anyone who has the string , can look at the original string that was formatted.</li> <li>conversion anyone can do , but verification of this string can only be done by authorized backend servers that has created it. <ul><li>given the string and the password, can pass it through a verification function and only return the original data , if the original thing was used to verify that.</li></ul></li> <li><code>jwt.verify(&lt;passwd&gt;)</code> and can verified, only then we can authenticate the user.</li> <li>very similar to encryption and decryption.</li> <li>![[Screenshot 2026-01-21 at 8.13.01 PM.png]]</li> <li><code>jwt.verify()</code> will only allow if the user if true, otherwise not.</li></ul></li> <li>its neither of encryption or hashing (its technically a digital signature)</li> <li>anyone can see the original output given the signature</li> <li>signature can be verified only using the password.</li></ul></li> <li>Local Storage <ul><li>a place in your browser where we can store some data</li> <li>usually things that are stored include: <ul><li>authentication tokens</li> <li>user language preferences</li> <li>user theme preferences</li> <li>etc</li></ul></li></ul></li></ul></li></ul> <h3>fetch</h3> <ul><li>to actually send requests from frontend to backend</li> <li>hitting the endpoint either by a browser or insomnia</li> <li>how to send a request when the button is sent.</li> <li>part of browser API , to hit to the backend server</li> <li>browsers expose something call fetch that hits the backend servers.</li> <li>![[Screenshot 2026-01-21 at 6.47.06 PM.png]]</li> <li>using the <code>fetch</code> api globally to fetch the responses</li> <li>on right clicking and clicking on the console, we can see the response.</li> <li>Eg: using the <code>faker</code> api , we can try for free some data and see their response.</li> <li>whenever the data resolves, the promise should reach there.</li> <li>fetch will return a Promise and using the promisified response to resolve based on that.</li></ul> <h3>Databases</h3> <ul><li>until now, we have been storing data in memory , bad for a few reasons <ul><li>data can’t be dynamic , if we update in memory objects, the updates are lost if the process restarts</li> <li>there are multiple servers in the real world</li></ul></li> <li>databases also support for querying and for optimized storage of the data.</li> <li>In the real world, you dont have a single backend server, you have a cluster <ul><li>![[Screenshot 2026-01-21 at 9.00.31 PM.png]]</li> <li>for most purposes we have multiple servers and connected to a single db (well not really in prod!), but still</li> <li>BE server fleet do business logic, do auth and other things.</li> <li>user hits the backend</li> <li>backend hits the database</li> <li>user doesnt have access to the database/ can’t talk to the DB.</li></ul></li> <li>how is the db exposed, how does be knows where to connect and etc? <ul><li>only the backend server knows the URL of the databases</li> <li>need to store secrets and also other things</li></ul></li> <li>there are various types of databases, depending on querying and the type of data that we want to store <ul><li>graph dbs</li> <li>vector dbs</li> <li>sql dbs</li> <li>nosql dbs</li></ul></li> <li>very famous nosql db -> mongodb</li></ul> <h4>MongoDB</h4> <ul><li>MongoDB lets us create databases</li> <li>In each DB, it lets us create tables(collections)</li> <li>in each table, it lets us dump JSON data.</li> <li>It is schemaless</li> <li>It scales well and is a decent choice for most use cases.</li> <li>How to work with it ? <ul><li>create a mongodb instance</li> <li>get our mongodb connection URL</li> <li>download mongodb compass and explore the DB</li></ul></li> <li>while creating databases we have to create database-table and a collection name for the same. <ul><li>can create multiple database and create multiple collections(tables)</li></ul></li> <li>create a new signup endpoint that users can come and hit it to enter the details to our database.</li> <li>can then do CRUD operations in the database.</li> <li>How does backend connects to the database ? <ul><li>using libraries !</li> <li>express lets u create an HTTP server</li> <li>jsonwebtokens library lets us create jwts</li> <li>mongoose lets us connect to your database</li></ul></li> <li>mongodb is schemaless, but for normal CRUD operations we need some abstraction to add to item to a mongodb database <ul><li>use the mongoose library to give schema and structure to it.</li></ul></li></ul>`,1);function k(e,a){const n=p(a,["children","$$slots","$$events","$$legacy"]);d(e,c(()=>n,()=>s,{children:(l,F)=>{var t=h();r(26),i(l,t)},$$slots:{default:!0}}))}export{k as default,s as metadata};
